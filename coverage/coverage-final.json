{"/Users/gianluca/Developer/binance-watcher/src/currency_pair.ts": {"path":"/Users/gianluca/Developer/binance-watcher/src/currency_pair.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":10,"column":8},"end":{"line":31,"column":10}},"3":{"start":{"line":11,"column":27},"end":{"line":11,"column":50}},"4":{"start":{"line":12,"column":12},"end":{"line":14,"column":13}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":49}},"6":{"start":{"line":15,"column":12},"end":{"line":17,"column":13}},"7":{"start":{"line":16,"column":16},"end":{"line":16,"column":49}},"8":{"start":{"line":18,"column":12},"end":{"line":20,"column":13}},"9":{"start":{"line":19,"column":16},"end":{"line":19,"column":52}},"10":{"start":{"line":21,"column":12},"end":{"line":21,"column":97}},"11":{"start":{"line":22,"column":12},"end":{"line":22,"column":45}},"12":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"13":{"start":{"line":24,"column":16},"end":{"line":24,"column":32}},"14":{"start":{"line":30,"column":12},"end":{"line":30,"column":27}},"15":{"start":{"line":32,"column":8},"end":{"line":32,"column":29}},"16":{"start":{"line":33,"column":8},"end":{"line":33,"column":29}},"17":{"start":{"line":34,"column":8},"end":{"line":34,"column":38}},"18":{"start":{"line":35,"column":8},"end":{"line":35,"column":67}},"19":{"start":{"line":41,"column":8},"end":{"line":41,"column":39}},"20":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"21":{"start":{"line":45,"column":12},"end":{"line":45,"column":49}},"22":{"start":{"line":47,"column":8},"end":{"line":47,"column":17}},"23":{"start":{"line":53,"column":8},"end":{"line":56,"column":9}},"24":{"start":{"line":54,"column":12},"end":{"line":54,"column":45}},"25":{"start":{"line":55,"column":12},"end":{"line":55,"column":44}},"26":{"start":{"line":59,"column":18},"end":{"line":59,"column":19}},"27":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"28":{"start":{"line":61,"column":12},"end":{"line":61,"column":49}},"29":{"start":{"line":63,"column":8},"end":{"line":65,"column":9}},"30":{"start":{"line":64,"column":12},"end":{"line":64,"column":52}},"31":{"start":{"line":66,"column":8},"end":{"line":66,"column":32}},"32":{"start":{"line":69,"column":18},"end":{"line":69,"column":19}},"33":{"start":{"line":70,"column":8},"end":{"line":72,"column":9}},"34":{"start":{"line":71,"column":12},"end":{"line":71,"column":49}},"35":{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},"36":{"start":{"line":74,"column":12},"end":{"line":74,"column":66}},"37":{"start":{"line":76,"column":8},"end":{"line":76,"column":19}},"38":{"start":{"line":83,"column":8},"end":{"line":83,"column":33}},"39":{"start":{"line":86,"column":0},"end":{"line":86,"column":62}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":32},"end":{"line":36,"column":5}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":30},"end":{"line":10,"column":31}},"loc":{"start":{"line":10,"column":48},"end":{"line":31,"column":9}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":40,"column":4},"end":{"line":40,"column":5}},"loc":{"start":{"line":40,"column":23},"end":{"line":42,"column":5}},"line":40},"3":{"name":"(anonymous_3)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":32},"end":{"line":48,"column":5}},"line":43},"4":{"name":"(anonymous_4)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":14},"end":{"line":57,"column":5}},"line":52},"5":{"name":"(anonymous_5)","decl":{"start":{"line":58,"column":4},"end":{"line":58,"column":5}},"loc":{"start":{"line":58,"column":48},"end":{"line":67,"column":5}},"line":58},"6":{"name":"(anonymous_6)","decl":{"start":{"line":68,"column":4},"end":{"line":68,"column":5}},"loc":{"start":{"line":68,"column":51},"end":{"line":77,"column":5}},"line":68},"7":{"name":"(anonymous_7)","decl":{"start":{"line":82,"column":4},"end":{"line":82,"column":5}},"loc":{"start":{"line":82,"column":32},"end":{"line":84,"column":5}},"line":82}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":12},"end":{"line":14,"column":13}},"type":"if","locations":[{"start":{"line":12,"column":12},"end":{"line":14,"column":13}},{"start":{"line":12,"column":12},"end":{"line":14,"column":13}}],"line":12},"1":{"loc":{"start":{"line":15,"column":12},"end":{"line":17,"column":13}},"type":"if","locations":[{"start":{"line":15,"column":12},"end":{"line":17,"column":13}},{"start":{"line":15,"column":12},"end":{"line":17,"column":13}}],"line":15},"2":{"loc":{"start":{"line":18,"column":12},"end":{"line":20,"column":13}},"type":"if","locations":[{"start":{"line":18,"column":12},"end":{"line":20,"column":13}},{"start":{"line":18,"column":12},"end":{"line":20,"column":13}}],"line":18},"3":{"loc":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"type":"if","locations":[{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},{"start":{"line":23,"column":12},"end":{"line":25,"column":13}}],"line":23},"4":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44},"5":{"loc":{"start":{"line":58,"column":24},"end":{"line":58,"column":34}},"type":"default-arg","locations":[{"start":{"line":58,"column":33},"end":{"line":58,"column":34}}],"line":58},"6":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"7":{"loc":{"start":{"line":68,"column":27},"end":{"line":68,"column":37}},"type":"default-arg","locations":[{"start":{"line":68,"column":36},"end":{"line":68,"column":37}}],"line":68},"8":{"loc":{"start":{"line":70,"column":8},"end":{"line":72,"column":9}},"type":"if","locations":[{"start":{"line":70,"column":8},"end":{"line":72,"column":9}},{"start":{"line":70,"column":8},"end":{"line":72,"column":9}}],"line":70}},"s":{"0":2,"1":2,"2":8,"3":1829,"4":1829,"5":1829,"6":1829,"7":13,"8":1829,"9":8,"10":1829,"11":1829,"12":1829,"13":2,"14":1829,"15":8,"16":8,"17":8,"18":8,"19":1829,"20":40,"21":25,"22":15,"23":1829,"24":9,"25":9,"26":6,"27":6,"28":6,"29":6,"30":23,"31":6,"32":2,"33":2,"34":2,"35":2,"36":12,"37":2,"38":1,"39":2},"f":{"0":8,"1":1829,"2":1829,"3":40,"4":1829,"5":6,"6":2,"7":1},"b":{"0":[1829,0],"1":[13,1816],"2":[8,1821],"3":[2,1827],"4":[25,15],"5":[1],"6":[6,0],"7":[1],"8":[2,0]},"inputSourceMap":{"version":3,"file":"currency_pair.js","sourceRoot":"","sources":["currency_pair.ts"],"names":[],"mappings":"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","sourcesContent":["import {Market, MarketTrades} from \"./types\";\n\n\nexport const RETENTION_TIME = 30 * 60; // Retention time is 30 minutes\n\nexport class CurrencyPairTradesCounter {\n\n  private market: Market;\n  public symbol: string;\n  private lastBucketCleaned?: number;\n  private timeMessages: Map<number, number>;\n  public oldestBucketStored?: number;\n  public newestBucketStored?: number;\n  private onUpdate?: () => void;\n\n  /**\n   * You need to pass an initialized market in order to start\n   * counting the number of transactions on a certain currency pair.\n   */\n  constructor(symbol: string, market: Market) {\n    this.symbol = symbol;\n    this.market = market;\n    this.timeMessages = new Map<number, number>();\n    this.market.subscribeToSymbol(symbol, this.incomingTrades);\n  }\n\n  /**\n   * @param time in milliseconds\n   */\n  private timeToBucket(time: number) {\n    return Math.floor(time / 1000);\n  }\n\n  private incomingTrades = (time: number, trades: MarketTrades) => {\n    const bucket = this.timeToBucket(time);\n    if (!this.timeMessages.has(bucket)) {\n      this.timeMessages.set(bucket, 0);\n    }\n    if (!this.oldestBucketStored) {\n      this.oldestBucketStored = bucket;\n    }\n    if (this.lastBucketCleaned === undefined) {\n      this.lastBucketCleaned = bucket - 1;\n    }\n    \n    this.timeMessages.set(bucket, this.timeMessages.get(bucket) + trades.numberOfTrades);\n    this.newestBucketStored = bucket;\n    if (this.onUpdate) {\n      this.onUpdate();\n    }\n\n    /**\n     * We must call a cleanup procedure in order to prevent the\n     * infinite growth of the bucket counter\n     */\n    this.cleanup();\n  }\n\n  public countTradesInBucket(bucket: number) {\n    if (this.timeMessages.has(bucket)) {\n      return this.timeMessages.get(bucket)\n    }\n    return 0;\n  }\n\n  /**\n   * Efficiently removes buckets that are older than RETENTION_TIME\n   */\n  private cleanup() {\n    for (\n      let bucket = this.lastBucketCleaned + 1; \n      bucket < this.newestBucketStored - RETENTION_TIME; \n      bucket += 1\n    ) {\n      this.timeMessages.delete(bucket);\n      this.lastBucketCleaned = bucket;\n    }\n  }\n\n  public getRate(numBuckets: number, offset: number = 1, lastBucket?: number) {\n    let sum = 0;\n    if (lastBucket === undefined) {\n      lastBucket = this.newestBucketStored;\n    }\n\n    for (let second = lastBucket - offset; second >= lastBucket - offset - numBuckets; second -= 1) {\n      sum += this.countTradesInBucket(second);\n    }\n    return sum / numBuckets;\n  }\n  \n  public getMaximum(numBuckets: number, offset: number = 1, lastBucket?: number) {\n    let max = 0;\n    if (lastBucket === undefined) {\n      lastBucket = this.newestBucketStored;\n    }\n\n    for (let second = lastBucket - offset; second >= lastBucket - offset - numBuckets; second -= 1) {\n      max = Math.max(this.countTradesInBucket(second), max);\n    }\n    return max;\n  }\n\n  /**\n   * Use this function in order to react to a change in\n   * internal attributes.\n   */\n  public subscribeToChange(callback: () => void) {\n    this.onUpdate = callback;\n  }\n}"]},"_coverageSchema":"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c","hash":"781979fc85bf4168544d16a9eb50a6f628a8107b"}
,"/Users/gianluca/Developer/binance-watcher/src/monitor.ts": {"path":"/Users/gianluca/Developer/binance-watcher/src/monitor.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":8},"end":{"line":5,"column":32}},"2":{"start":{"line":6,"column":8},"end":{"line":6,"column":38}},"3":{"start":{"line":9,"column":8},"end":{"line":9,"column":63}},"4":{"start":{"line":12,"column":8},"end":{"line":12,"column":27}},"5":{"start":{"line":13,"column":8},"end":{"line":23,"column":9}},"6":{"start":{"line":14,"column":26},"end":{"line":14,"column":63}},"7":{"start":{"line":15,"column":26},"end":{"line":15,"column":63}},"8":{"start":{"line":16,"column":27},"end":{"line":16,"column":68}},"9":{"start":{"line":17,"column":32},"end":{"line":17,"column":73}},"10":{"start":{"line":18,"column":12},"end":{"line":20,"column":13}},"11":{"start":{"line":19,"column":16},"end":{"line":19,"column":46}},"12":{"start":{"line":21,"column":28},"end":{"line":21,"column":57}},"13":{"start":{"line":22,"column":12},"end":{"line":22,"column":109}},"14":{"start":{"line":24,"column":8},"end":{"line":24,"column":58}},"15":{"start":{"line":25,"column":8},"end":{"line":25,"column":43}},"16":{"start":{"line":26,"column":8},"end":{"line":26,"column":58}},"17":{"start":{"line":29,"column":22},"end":{"line":29,"column":62}},"18":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"19":{"start":{"line":31,"column":12},"end":{"line":31,"column":42}},"20":{"start":{"line":35,"column":8},"end":{"line":35,"column":40}},"21":{"start":{"line":38,"column":8},"end":{"line":42,"column":9}},"22":{"start":{"line":39,"column":12},"end":{"line":41,"column":15}},"23":{"start":{"line":40,"column":16},"end":{"line":40,"column":44}},"24":{"start":{"line":43,"column":29},"end":{"line":43,"column":30}},"25":{"start":{"line":44,"column":8},"end":{"line":47,"column":17}},"26":{"start":{"line":45,"column":12},"end":{"line":45,"column":32}},"27":{"start":{"line":46,"column":12},"end":{"line":46,"column":47}},"28":{"start":{"line":50,"column":0},"end":{"line":50,"column":26}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":4},"end":{"line":4,"column":5}},"loc":{"start":{"line":4,"column":18},"end":{"line":7,"column":5}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":8,"column":4},"end":{"line":8,"column":5}},"loc":{"start":{"line":8,"column":46},"end":{"line":10,"column":5}},"line":8},"2":{"name":"(anonymous_2)","decl":{"start":{"line":11,"column":4},"end":{"line":11,"column":5}},"loc":{"start":{"line":11,"column":34},"end":{"line":27,"column":5}},"line":11},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":27},"end":{"line":33,"column":5}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":4},"end":{"line":34,"column":5}},"loc":{"start":{"line":34,"column":18},"end":{"line":36,"column":5}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":37,"column":4},"end":{"line":37,"column":5}},"loc":{"start":{"line":37,"column":22},"end":{"line":48,"column":5}},"line":37},"6":{"name":"(anonymous_6)","decl":{"start":{"line":39,"column":57},"end":{"line":39,"column":58}},"loc":{"start":{"line":39,"column":63},"end":{"line":41,"column":13}},"line":39},"7":{"name":"(anonymous_7)","decl":{"start":{"line":44,"column":20},"end":{"line":44,"column":21}},"loc":{"start":{"line":44,"column":26},"end":{"line":47,"column":9}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":12},"end":{"line":20,"column":13}},"type":"if","locations":[{"start":{"line":18,"column":12},"end":{"line":20,"column":13}},{"start":{"line":18,"column":12},"end":{"line":20,"column":13}}],"line":18},"1":{"loc":{"start":{"line":22,"column":80},"end":{"line":22,"column":105}},"type":"cond-expr","locations":[{"start":{"line":22,"column":90},"end":{"line":22,"column":100}},{"start":{"line":22,"column":103},"end":{"line":22,"column":105}}],"line":22},"2":{"loc":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},{"start":{"line":30,"column":8},"end":{"line":32,"column":9}}],"line":30}},"s":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":2,"18":2,"19":1,"20":0,"21":1,"22":1,"23":2,"24":1,"25":1,"26":0,"27":0,"28":1},"f":{"0":1,"1":1,"2":0,"3":2,"4":0,"5":1,"6":2,"7":0},"b":{"0":[0,0],"1":[0,0],"2":[1,1]},"inputSourceMap":{"version":3,"file":"monitor.js","sourceRoot":"","sources":["monitor.ts"],"names":[],"mappings":";;AAEA;IAAA;QACS,kBAAa,GAEhB,EAAE,CAAC;QAEA,iBAAY,GAAG,IAAI,GAAG,EAAU,CAAC;IAiD1C,CAAC;IA/CQ,2BAA2B,CAAC,YAAuC;QACxE,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,YAAY,CAAC;IACzD,CAAC;IAEO,aAAa,CAAC,cAAsB;QAC1C,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,GAAG,CAAC,CAAC,IAAI,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACtC,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACpD,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACpD,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;YACzD,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAC9D,EAAE,CAAC,CAAC,KAAK,IAAI,GAAG,CAAC,CAAC,CAAC;gBACjB,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAChC,CAAC;YACD,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAC9C,OAAO,CAAC,GAAG,CAAC,GAAG,MAAM,KAAK,KAAK,IAAI,KAAK,IAAI,WAAW,IAAI,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACnG,CAAC;QACD,OAAO,CAAC,GAAG,CAAC,oBAAoB,cAAc,EAAE,CAAC,CAAC;QAClD,OAAO,CAAC,GAAG,CAAC,SAAS,IAAI,IAAI,EAAE,EAAE,CAAC,CAAC;QACnC,OAAO,CAAC,GAAG,CAAC,YAAY,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC;IACpD,CAAC;IAEO,cAAc,CAAC,MAAc;QACnC,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACvD,EAAE,CAAC,CAAC,KAAK,IAAI,GAAG,CAAC,CAAC,CAAC;YACjB,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC;IACH,CAAC;IAEO,WAAW;QACjB,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IAClC,CAAC;IAEM,eAAe;QACpB,GAAG,CAAC,CAAC,IAAI,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACtC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,iBAAiB,CAAC,GAAG,EAAE;gBAChD,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;YAC9B,CAAC,CAAC,CAAC;QACL,CAAC;QAED,IAAI,cAAc,GAAG,CAAC,CAAC;QACvB,WAAW,CAAC,GAAG,EAAE;YACf,cAAc,IAAI,CAAC,CAAC;YACpB,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;QACrC,CAAC,EAAE,IAAI,CAAC,CAAC;IACX,CAAC;CACF;AAtDD,0BAsDC","sourcesContent":["import { CurrencyPairTradesCounter } from \"./currency_pair\";\n\nexport class Monitor {\n  public currencyPairs: {\n    [symbol: string]: CurrencyPairTradesCounter\n  } = {};\n\n  public flaggedPairs = new Set<string>();\n  \n  public addCurrencyPairTradeCounter(currencyPair: CurrencyPairTradesCounter) {\n    this.currencyPairs[currencyPair.symbol] = currencyPair;\n  }\n\n  private printOnScreen(elapsedSeconds: number) {\n    this.clearScreen();\n\n    for (let symbol in this.currencyPairs) {\n      const rate1 = this.currencyPairs[symbol].getRate(1);\n      const rate2 = this.currencyPairs[symbol].getRate(2);\n      const max120 = this.currencyPairs[symbol].getMaximum(30);\n      const average30d5 = this.currencyPairs[symbol].getRate(30, 5);\n      if (rate2 >= 100) {\n        this.flaggedPairs.add(symbol);\n      }\n      const flagged = this.flaggedPairs.has(symbol);\n      console.log(`${symbol}: ${rate1}/${rate2}/${average30d5}/${max120}${flagged ? '/FLAGGED' : ''}`);\n    }\n    console.log(`Elapsed seconds: ${elapsedSeconds}`);\n    console.log(`Time: ${new Date()}`);\n    console.log(`Flagged: ${this.flaggedPairs.size}`);\n  }\n\n  private checkCondition(symbol: string) {\n    const rate2 = this.currencyPairs[symbol].getRate(2, 0);\n    if (rate2 >= 100) {\n      this.flaggedPairs.add(symbol);\n    }\n  }\n\n  private clearScreen() {\n    process.stdout.write(\"\\x1B[2J\");\n  }\n\n  public startMonitoring() {\n    for (let symbol in this.currencyPairs) {\n      this.currencyPairs[symbol].subscribeToChange(() => {\n        this.checkCondition(symbol);\n      });\n    }\n\n    let elapsedSeconds = 0;\n    setInterval(() => {\n      elapsedSeconds += 1;\n      this.printOnScreen(elapsedSeconds);\n    }, 1000);\n  }\n}"]},"_coverageSchema":"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c","hash":"3ab62d101822041dbdadfa0ce9f82a5ee53344ca"}
,"/Users/gianluca/Developer/binance-watcher/test/utils.ts": {"path":"/Users/gianluca/Developer/binance-watcher/test/utils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":8},"end":{"line":5,"column":42}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":56}},"3":{"start":{"line":11,"column":8},"end":{"line":13,"column":9}},"4":{"start":{"line":12,"column":12},"end":{"line":12,"column":63}},"5":{"start":{"line":16,"column":0},"end":{"line":16,"column":32}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":4},"end":{"line":4,"column":5}},"loc":{"start":{"line":4,"column":18},"end":{"line":6,"column":5}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":7,"column":4},"end":{"line":7,"column":5}},"loc":{"start":{"line":7,"column":40},"end":{"line":9,"column":5}},"line":7},"2":{"name":"(anonymous_2)","decl":{"start":{"line":10,"column":4},"end":{"line":10,"column":5}},"loc":{"start":{"line":10,"column":41},"end":{"line":14,"column":5}},"line":10}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":8},"end":{"line":13,"column":9}},"type":"if","locations":[{"start":{"line":11,"column":8},"end":{"line":13,"column":9}},{"start":{"line":11,"column":8},"end":{"line":13,"column":9}}],"line":11}},"s":{"0":2,"1":7,"2":8,"3":1829,"4":1829,"5":2},"f":{"0":7,"1":8,"2":1829},"b":{"0":[1829,0]},"inputSourceMap":{"version":3,"file":"utils.js","sourceRoot":"","sources":["utils.ts"],"names":[],"mappings":";;AAEA;IAAA;QACE,4BAAuB,GAEnB,EAAE,CAAC;IAcT,CAAC;IAZQ,iBAAiB,CACtB,MAAc,EACd,QAAsD;QAEtD,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,GAAG,QAAQ,CAAC;IAClD,CAAC;IAEM,cAAc,CAAC,MAAc,EAAE,IAAY,EAAE,MAAoB;QACtE,EAAE,CAAC,CAAC,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACzC,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QACrD,CAAC;IACH,CAAC;CACF;AAjBD,gCAiBC","sourcesContent":["import { Market, MarketTrades } from \"../src/types\";\n\nexport class TestMarket implements Market {\n  incomingTradesCallbacks?: {\n    [symbol: string]: (time: number, trades: MarketTrades) => void\n  } = {};\n\n  public subscribeToSymbol(\n    symbol: string, \n    callback: (time: number, trades: MarketTrades) => void\n  ) {\n    this.incomingTradesCallbacks[symbol] = callback;\n  }\n\n  public dispatchTrades(symbol: string, time: number, trades: MarketTrades) {\n    if (this.incomingTradesCallbacks[symbol]) {\n      this.incomingTradesCallbacks[symbol](time, trades);\n    }\n  }\n}"]},"_coverageSchema":"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c","hash":"eed8b48ef07230dc42a9c62cca4189ab07599a14"}
}
